<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Code Login</title>
    <script src="https://unpkg.com/html5-qrcode"></script>
</head>
<body>
    <div>
        <img src="NimbleLogo.png" alt="Company Logo">
        <h2>QR Code Login</h2>

        <!-- Phone Input -->
        <div id="phoneSection">
            <label>Enter Phone Number:</label>
            <input type="text" id="phone" placeholder="Enter phone number">
            <button id="sendOTP">Send OTP</button>
        </div>

        <!-- OTP Section -->
        <div id="otpSection" style="display:none">
            <p id="otpDisplay"></p>
            <div id="otpTimer"></div>
            <label>Enter OTP:</label>
            <input type="text" id="otp" placeholder="Enter OTP">
            <button id="verifyOTP">Verify OTP</button>
            <button id="newOTP" style="display:none">Request New OTP</button>
        </div>

        <!-- QR Section -->
        <div id="qrSection" style="display:none">
            <div id="qrTimer"></div>
            <button id="scanQR">Scan QR Code</button>
            <p id="scanMessage"></p>
            <div id="qr-video"></div>
        </div>
    </div>

    <script>
        let scanner;
        let otpTimer;
        let qrTimer;
        const OTP_TIME_LIMIT = 30;
        const QR_TIME_LIMIT = 60;

        // Send OTP
        document.getElementById("sendOTP").addEventListener("click", function() {
            const phone = document.getElementById("phone").value.trim();
            if (!phone) return alert("Please enter phone number");

            // In a real app, you would call your API here
            console.log("Sending OTP to:", phone);
            
            document.getElementById("otpSection").style.display = "block";
            document.getElementById("otpDisplay").textContent = "OTP sent to " + phone;
            document.getElementById("phoneSection").style.display = "none";
            
            startOtpTimer();
        });

        // Request New OTP
        document.getElementById("newOTP").addEventListener("click", function() {
            document.getElementById("phoneSection").style.display = "block";
            document.getElementById("otpSection").style.display = "none";
            document.getElementById("otp").value = "";
            clearInterval(otpTimer);
        });

        // Verify OTP
        document.getElementById("verifyOTP").addEventListener("click", function() {
            const otp = document.getElementById("otp").value.trim();
            if (!otp) return alert("Please enter OTP");

            // In a real app, you would verify with your API
            console.log("Verifying OTP:", otp);
            
            document.getElementById("qrSection").style.display = "block";
            document.getElementById("otpSection").style.display = "none";
            clearInterval(otpTimer);
            startQrTimer();
        });

        // Scan QR
        document.getElementById("scanQR").addEventListener("click", function() {
            if (!scanner) {
                scanner = new Html5QrcodeScanner("qr-video", { fps: 10, qrbox: 250 });
            }

            scanner.render((decodedText) => {
                console.log("Scanned:", decodedText);
                scanner.clear();
                scanner = null;
                clearInterval(qrTimer);
                document.getElementById("scanMessage").textContent = "QR Code scanned successfully!";
            }, (error) => {
                console.error("QR Error:", error);
            });
        });

        // OTP Timer
        function startOtpTimer() {
            let timeLeft = OTP_TIME_LIMIT;
            updateOtpTimer(timeLeft);
            
            otpTimer = setInterval(() => {
                timeLeft--;
                updateOtpTimer(timeLeft);
                if (timeLeft <= 0) {
                    clearInterval(otpTimer);
                    document.getElementById("otp").disabled = true;
                    document.getElementById("verifyOTP").disabled = true;
                    document.getElementById("newOTP").style.display = "inline";
                    document.getElementById("otpTimer").textContent = "OTP expired!";
                }
            }, 1000);
        }

        function updateOtpTimer(seconds) {
            document.getElementById("otpTimer").textContent = `Time left: ${seconds}s`;
        }

        // QR Timer
        function startQrTimer() {
            let timeLeft = QR_TIME_LIMIT;
            updateQrTimer(timeLeft);
            
            qrTimer = setInterval(() => {
                timeLeft--;
                updateQrTimer(timeLeft);
                if (timeLeft <= 0) {
                    clearInterval(qrTimer);
                    if (scanner) scanner.clear();
                    document.getElementById("scanQR").disabled = true;
                    document.getElementById("qrTimer").textContent = "QR time expired!";
                }
            }, 1000);
        }

        function updateQrTimer(seconds) {
            document.getElementById("qrTimer").textContent = `Scan time left: ${seconds}s`;
        }
    </script>
</body>
</html>
